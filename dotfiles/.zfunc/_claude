#compdef claude

# Zsh completion for the Claude Code CLI
# https://docs.anthropic.com/en/docs/claude-code

_claude_commands() {
  local -a commands=(
    'doctor:Check the health of your Claude Code auto-updater'
    'install:Install Claude Code native build'
    'mcp:Configure and manage MCP servers'
    'plugin:Manage Claude Code plugins'
    'setup-token:Set up a long-lived authentication token'
    'update:Check for updates and install if available'
  )
  _describe -t commands 'claude command' commands
}

_claude() {
  local curcontext="$curcontext" state line
  typeset -A opt_args

  _arguments -C \
    '--add-dir[Additional directories to allow tool access to]:directories:_files -/' \
    '--agent[Agent for the current session]:agent:' \
    '--agents[JSON object defining custom agents]:json:' \
    '--allow-dangerously-skip-permissions[Enable bypassing all permission checks as an option]' \
    '(--allowedTools --allowed-tools)'{--allowedTools,--allowed-tools}'[Tool names to allow]:tools:' \
    '--append-system-prompt[Append to the default system prompt]:prompt:' \
    '--betas[Beta headers to include in API requests]:betas:' \
    '--chrome[Enable Claude in Chrome integration]' \
    '(-c --continue)'{-c,--continue}'[Continue the most recent conversation]' \
    '--dangerously-skip-permissions[Bypass all permission checks]' \
    '(-d --debug)'{-d,--debug}'[Enable debug mode with optional category filtering]:filter:' \
    '--debug-file[Write debug logs to a specific file path]:path:_files' \
    '--disable-slash-commands[Disable all skills]' \
    '(--disallowedTools --disallowed-tools)'{--disallowedTools,--disallowed-tools}'[Tool names to deny]:tools:' \
    '--fallback-model[Fallback model when default is overloaded]:model:' \
    '--file[File resources to download at startup]:specs:' \
    '--fork-session[Create a new session ID instead of reusing the original]' \
    '--from-pr[Resume a session linked to a PR]:pr:' \
    '(-h --help)'{-h,--help}'[Display help for command]' \
    '--ide[Automatically connect to IDE on startup]' \
    '--include-partial-messages[Include partial message chunks as they arrive]' \
    '--input-format[Input format]:format:(text stream-json)' \
    '--json-schema[JSON Schema for structured output validation]:schema:' \
    '--max-budget-usd[Maximum dollar amount to spend on API calls]:amount:' \
    '*--mcp-config[Load MCP servers from JSON files or strings]:config:_files' \
    '--mcp-debug[Enable MCP debug mode]' \
    '--model[Model for the current session]:model:(haiku sonnet opus)' \
    '--no-chrome[Disable Claude in Chrome integration]' \
    '--no-session-persistence[Disable session persistence]' \
    '--output-format[Output format]:format:(text json stream-json)' \
    '--permission-mode[Permission mode for the session]:mode:(acceptEdits bypassPermissions default delegate dontAsk plan)' \
    '*--plugin-dir[Load plugins from directories]:path:_files -/' \
    '(-p --print)'{-p,--print}'[Print response and exit]' \
    '--replay-user-messages[Re-emit user messages from stdin back on stdout]' \
    '(-r --resume)'{-r,--resume}'[Resume a conversation by session ID]:session:' \
    '--session-id[Use a specific session ID]:uuid:' \
    '--setting-sources[Comma-separated list of setting sources]:sources:' \
    '--settings[Path to settings JSON file or JSON string]:file-or-json:_files' \
    '--strict-mcp-config[Only use MCP servers from --mcp-config]' \
    '--system-prompt[System prompt for the session]:prompt:' \
    '*--tools[Specify available tools]:tools:' \
    '--verbose[Override verbose mode setting]' \
    '(-v --version)'{-v,--version}'[Output the version number]' \
    '1: :_claude_commands' \
    '*::arg:->args'

  case $state in
    args)
      case $line[1] in
        install)
          _arguments \
            '1:target:(stable latest)'
          ;;
        mcp)
          _arguments \
            '1:mcp subcommand:(add remove list)'
          ;;
      esac
      ;;
  esac
}

_claude "$@"
